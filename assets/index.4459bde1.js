var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,l=Object.getOwnPropertySymbols,t=Object.prototype.propertyIsEnumerable,n=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,s=(e,s)=>{for(var i in s||(s={}))a.call(s,i)&&n(e,i,s[i]);if(l)for(var i of l(s))t.call(s,i)&&n(e,i,s[i]);return e};import{r as i,c as r,l as o,a as c,w as p,o as u,b as d,d as g,e as m,v as f,f as b,F as v,g as y,t as h,h as k,i as E,j as T,k as w,m as C,n as R}from"./vendor.5b531569.js";!function(e=".",a="__import__"){try{self[a]=new Function("u","return import(u)")}catch(l){const t=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[a]=e=>new Promise(((l,s)=>{const i=new URL(e,t);if(self[a].moduleMap[i])return l(self[a].moduleMap[i]);const r=new Blob([`import * as m from '${i}';`,`${a}.moduleMap['${i}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){s(new Error(`Failed to import: ${e}`)),n(o)},onload(){l(self[a].moduleMap[i]),n(o)}});document.head.appendChild(o)})),self[a].moduleMap={}}}("assets/");const O={id:"36ec601ba440417ead12dc49d612665d"},M=i(null),S=r((async()=>{const[e]=await o(["esri/layers/FeatureLayer"]);return new e(M.value)})),j=r((async()=>{const[e]=await o(["esri/WebMap"]);return new e({portalItem:O})}));function D(e){return new Date(e).toLocaleString()}const P=c({loading:!1,error:"",data:[]}),_=i(null),L=r((()=>P.data.find((e=>{var a;return(null==(a=e.attributes)?void 0:a.objectid)==_.value}))));function U(e){_.value=e}const x=c({page:1,limit:10}),F=i(0),N=r((()=>x.limit*(x.page-1))),A=r((()=>Math.ceil(F.value/x.limit))),$=c({upcoming:!1,search:""});p([x,$],((e,a=500)=>{let l=null;return(...t)=>{window.clearTimeout(l),l=window.setTimeout((()=>{e.apply(null,t)}),a)}})((()=>{if(x.page>A.value)return x.page=1;V()})));const I=r((()=>["DATE_OPENED >= CURRENT_TIMESTAMP+1",$.search?`STREET like '%${$.search}%'`:null,$.upcoming?"DATE_CLOSED > CURRENT_TIMESTAMP":"(DATE_CLOSED <= CURRENT_TIMESTAMP)"].filter(Boolean).join(" AND "))),G=r((()=>({where:I.value,f:"json",outFields:"*",orderByFields:["DATE_CLOSED asc","DATE_OPENED asc","STREET asc"],returnGeometry:!0,num:x.limit,start:N.value})));async function V(){P.error="",P.loading=!0;try{const e=await S.value;F.value=await e.queryFeatureCount({where:I.value});const{features:a}=await e.queryFeatures(G.value);P.data=a.map((a=>s(s({},a.toJSON()),{popupTemplate:e.popupInfo})))}catch(e){P.error=e.message}finally{P.loading=!1}}const B={setup:()=>({filters:$})},J={class:"d-flex justify-content-between align-items-center flex-wrap"},q={class:"flex-grow-1"},W={class:"p-2"},Y={class:"form-check form-check-inline"},z=g("label",{class:"form-check-label",for:"inlineRadio1"}," Current Closures ",-1),H={class:"form-check form-check-inline"},K=g("label",{class:"form-check-label",for:"inlineRadio2"}," Upcoming Closures ",-1);B.render=function(e,a,l,t,n,s){return u(),d("div",J,[g("div",q,[m(g("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>t.filters.search=e),type:"text",class:"form-control",placeholder:"Filter by street name"},null,512),[[f,t.filters.search]])]),g("div",W,[g("div",Y,[m(g("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>t.filters.upcoming=e),class:"form-check-input",type:"radio",name:"currentOrUpcomingRadioGroup",id:"inlineRadio1",value:!1},null,512),[[b,t.filters.upcoming]]),z]),g("div",H,[m(g("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>t.filters.upcoming=e),class:"form-check-input",type:"radio",name:"currentOrUpcomingRadioGroup",id:"inlineRadio2",value:!0},null,512),[[b,t.filters.upcoming]]),K])])])};const Q={setup:()=>({closures:P,activateClosure:U,formatDate:D})},X={key:0,class:"table-responsive"},Z={class:"table table-striped table-sm small"},ee=g("thead",null,[g("tr",null,[g("th",null,"Street"),g("th",null,"Type"),g("th",null,"Closed"),g("th",null,"Opened")])],-1),ae=g("br",null,null,-1),le=k(" from "),te=k(" to "),ne={key:1,class:"text-center py-5"},se=g("p",{class:"h4"},"No Closures",-1),ie=g("p",null,"Try refining your search.",-1);Q.render=function(e,a,l,t,n,s){return t.closures.data.length?(u(),d("div",X,[g("table",Z,[ee,g("tbody",null,[(u(!0),d(v,null,y(t.closures.data,(({attributes:e})=>(u(),d("tr",{key:e.objectid,id:`closure-${e.objectid}`},[g("td",null,[g("strong",null,[g("a",{href:"#","data-bs-toggle":"modal","data-bs-target":"#popupModalLabel",onClick:a=>t.activateClosure(e.objectid)},h(e.STREET),9,["onClick"])]),ae,g("small",null,[le,g("strong",null,h(e.FROM_STREET),1),te,g("strong",null,h(e.TO_STREET),1)])]),g("td",null,h(e.CLOSURE_TYPE.split("_").join(" ")),1),g("td",null,h(t.formatDate(e.DATE_CLOSED)),1),g("td",null,h(t.formatDate(e.DATE_OPENED)),1)],8,["id"])))),128))])])])):(u(),d("div",ne,[se,ie]))};const re={setup:()=>({pagination:x,pages:A})},oe={key:0},ce={class:"row align-items-center"},pe={class:"col-sm-9"},ue={"aria-label":"Page navigation"},de={class:"m-0 pagination justify-content-center"},ge=g("span",{"aria-hidden":"true"},"«",-1),me={key:0,class:"page-item disabled"},fe=g("span",{class:"page-link"},"...",-1),be={key:1,class:"page-item disabled"},ve=g("span",{class:"page-link"},"...",-1),ye=g("span",{"aria-hidden":"true"},"»",-1),he={class:"col-sm-3"};re.render=function(e,a,l,t,n,s){return t.pages>1?(u(),d("div",oe,[g("div",ce,[g("div",pe,[g("nav",ue,[g("ul",de,[g("li",{class:["page-item",1==t.pagination.page?"disabled":null]},[g("a",{class:"page-link",href:"#",tabindex:"-1","aria-disabled":1==t.pagination.page,onClick:a[1]||(a[1]=E((e=>t.pagination.page--),["prevent"])),"aria-label":"Previous"},[ge],8,["aria-disabled"])],2),g("li",{class:["page-item",1==t.pagination.page?"active":null],"aria-current":1==t.pagination.page&&"page"},[g("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=E((e=>t.pagination.page=1),["prevent"]))}," 1 ")],10,["aria-current"]),t.pagination.page>3?(u(),d("li",me,[fe])):T("",!0),(u(!0),d(v,null,y(t.pages,(e=>(u(),d(v,{key:e},[1!=e&&e!=t.pages&&Math.abs(t.pagination.page-e)<3?(u(),d("li",{key:0,class:["page-item",t.pagination.page==e?"active":null],"aria-current":t.pagination.page==e&&"page"},[g("a",{class:"page-link",href:"#",onClick:E((a=>t.pagination.page=e),["prevent"])},h(e),9,["onClick"])],10,["aria-current"])):T("",!0)],64)))),128)),t.pagination.page<t.pages-3?(u(),d("li",be,[ve])):T("",!0),g("li",{class:["page-item",t.pagination.page==t.pages?"active":null],"aria-current":t.pagination.page==t.pages&&"page"},[g("a",{class:"page-link",href:"#",onClick:a[3]||(a[3]=E((e=>t.pagination.page=t.pages),["prevent"]))},h(t.pages),1)],10,["aria-current"]),g("li",{class:["page-item",t.pagination.page==t.pages?"disabled":null]},[g("a",{class:"page-link",href:"#","aria-disabled":t.pagination.page==t.pages,onClick:a[4]||(a[4]=E((e=>t.pagination.page++),["prevent"])),"aria-label":"Next"},[ye],8,["aria-disabled"])],2)])])]),g("div",he,[m(g("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>t.pagination.limit=e),class:"form-select form-control","aria-label":"Results per page"},[(u(),d(v,null,y([10,25,50],(e=>g("option",{key:e,value:e},h(`${e} results per page`),9,["value"]))),64))],512),[[w,t.pagination.limit]])])])])):T("",!0)};const ke={},Ee={class:"ratio ratio-16x9"},Te=g("iframe",{src:"./map.html",frameborder:"0"},null,-1);ke.render=function(e,a){return u(),d("div",Ee,[Te])};let we={};const Ce=i(null);i(null),p(L,(async function(e){we.visible=!1;const[a,l]=await o(["esri/Graphic","esri/widgets/Popup"]),t=a.fromJSON(e);we=new l({container:Ce.value,features:[t]}),we.visible=!0}));const Re={setup:()=>({popupRef:Ce,activeClosure:L})},Oe={class:"modal fade",id:"popupModal",tabindex:"-1","aria-labelledby":"popupModalLabel","aria-hidden":"true"},Me={class:"modal-dialog modal-xl"},Se={class:"modal-content"},je={class:"modal-header"},De={class:"modal-title",id:"popupModalLabel"},Pe=g("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),_e={ref:"popupRef",class:"modal-body"},Le=g("div",{class:"modal-footer"},[g("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ")],-1);Re.render=function(e,a,l,t,n,s){var i,r;return u(),d("div",Oe,[g("div",Me,[g("div",Se,[g("div",je,[g("h5",De,h(null==(r=null==(i=t.activeClosure)?void 0:i.attributes)?void 0:r.STREET),1),Pe]),g("div",_e,null,512),Le])])])};const Ue={setup:()=>(async function(){const e=await j.value;await e.load(),M.value=e.layers.items[0].toJSON()}().then(V),{closures:P}),components:{Filters:B,ClosuresTable:Q,Pagination:re,ClosuresMap:ke,ModalPopup:Re}},xe={key:0,class:"py-5"},Fe={class:"alert alert-warning",role:"alert"},Ne={key:1},Ae={key:0,class:"p-5 text-center"},$e=g("div",{class:"spinner-border text-dark",role:"status"},[g("span",{class:"visually-hidden"},"Loading...")],-1);Ue.render=function(e,a,l,t,n,s){const i=C("ClosuresMap"),r=C("Filters"),o=C("ClosuresTable"),c=C("Pagination"),p=C("ModalPopup");return t.closures.error?(u(),d("div",xe,[g("div",Fe,h(t.closures.error),1)])):(u(),d("div",Ne,[g(i),g(r,{class:"my-3"}),t.closures.loading?(u(),d("div",Ae,[$e])):(u(),d(o,{key:1})),g(c),g(p)]))},R(Ue).mount("#app");
