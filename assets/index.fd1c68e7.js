var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,l=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,t=(a,l,n)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[l]=n,i=(e,i)=>{for(var s in i||(i={}))a.call(i,s)&&t(e,s,i[s]);if(l)for(var s of l(i))n.call(i,s)&&t(e,s,i[s]);return e};import{r as s,l as o,a as r,c,w as p,o as u,b as d,d as g,e as m,v as f,f as v,F as b,g as y,t as w,h as E,i as h,j as k,k as T,m as C,n as R,p as O}from"./vendor.b3566522.js";!function(e=".",a="__import__"){try{self[a]=new Function("u","return import(u)")}catch(l){const n=new URL(e,location),t=e=>{URL.revokeObjectURL(e.src),e.remove()};self[a]=e=>new Promise(((l,i)=>{const s=new URL(e,n);if(self[a].moduleMap[s])return l(self[a].moduleMap[s]);const o=new Blob([`import * as m from '${s}';`,`${a}.moduleMap['${s}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){i(new Error(`Failed to import: ${e}`)),t(r)},onload(){l(self[a].moduleMap[s]),t(r)}});document.head.appendChild(r)})),self[a].moduleMap={}}}("assets/");const M={id:"36ec601ba440417ead12dc49d612665d"};async function S(){const[e]=await o(["esri/WebMap"]);return new e({portalItem:M})}const D=s(null);function j(e){return new Date(e).toLocaleString()}const x=r({loading:!1,error:"",data:[]}),L=s(null),P=c((()=>x.data.find((e=>{var a;return(null==(a=e.attributes)?void 0:a.objectid)==L.value}))));function _(e){L.value=e}const U=r({page:1,limit:10}),N=s(0),A=c((()=>U.limit*(U.page-1))),F=c((()=>Math.ceil(N.value/U.limit))),I=r({upcoming:!1,search:""});p([U,I],((e,a=500)=>{let l=null;return(...n)=>{window.clearTimeout(l),l=window.setTimeout((()=>{e.apply(null,n)}),a)}})((()=>{if(U.page>F.value)return U.page=1;V()})));const $=c((()=>{var e,a;return[null==(a=null==(e=D.value)?void 0:e.layerDefinition)?void 0:a.definitionExpression,"DATE_OPENED >= CURRENT_TIMESTAMP+1",I.search?`STREET like '%${I.search}%'`:null,I.upcoming?"DATE_CLOSED > CURRENT_TIMESTAMP":"(DATE_CLOSED <= CURRENT_TIMESTAMP)"].filter(Boolean).join(" AND ")})),G=c((()=>({where:$.value,f:"json",outFields:"*",orderByFields:["DATE_CLOSED "+(I.upcoming?"asc":"desc"),"DATE_OPENED asc","STREET asc"],returnGeometry:!0,num:U.limit,start:A.value})));async function V(){x.error="",x.loading=!0;try{const e=await async function(){const[e]=await o(["esri/layers/FeatureLayer"]);return new e(D.value)}();console.log("query def",e.definitionExpression),N.value=await e.queryFeatureCount({where:$.value});const{features:a}=await e.queryFeatures(G.value);x.data=a.map((a=>i(i({},a.toJSON()),{popupTemplate:e.popupInfo})))}catch(e){x.error=e.message}finally{x.loading=!1}}const J={setup:()=>({filters:I})},q={class:"d-flex justify-content-between align-items-center flex-wrap"},B={class:"flex-grow-1"},H={class:"p-2"},W={class:"form-check form-check-inline"},Y=g("label",{class:"form-check-label",for:"inlineRadio1"}," Current Closures ",-1),z={class:"form-check form-check-inline"},K=g("label",{class:"form-check-label",for:"inlineRadio2"}," Upcoming Closures ",-1);J.render=function(e,a,l,n,t,i){return u(),d("div",q,[g("div",B,[m(g("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>n.filters.search=e),type:"text",class:"form-control",placeholder:"Filter by street name"},null,512),[[f,n.filters.search]])]),g("div",H,[g("div",W,[m(g("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>n.filters.upcoming=e),class:"form-check-input",type:"radio",name:"currentOrUpcomingRadioGroup",id:"inlineRadio1",value:!1},null,512),[[v,n.filters.upcoming]]),Y]),g("div",z,[m(g("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>n.filters.upcoming=e),class:"form-check-input",type:"radio",name:"currentOrUpcomingRadioGroup",id:"inlineRadio2",value:!0},null,512),[[v,n.filters.upcoming]]),K])])])};const Q={setup:()=>({closures:x,activateClosure:_,formatDate:j})},X={key:0,class:"table-responsive"},Z={class:"table table-striped table-sm small"},ee=g("thead",null,[g("tr",null,[g("th",null,"Street"),g("th",null,"Type"),g("th",null,"Closed"),g("th",null,"Opened")])],-1),ae=g("br",null,null,-1),le=E(" from "),ne=E(" to "),te={key:1,class:"text-center py-5"},ie=g("p",{class:"h4"},"No Closures",-1),se=g("p",null,"Try refining your search.",-1);Q.render=function(e,a,l,n,t,i){return n.closures.data.length?(u(),d("div",X,[g("table",Z,[ee,g("tbody",null,[(u(!0),d(b,null,y(n.closures.data,(({attributes:e})=>(u(),d("tr",{key:e.objectid,id:`closure-${e.objectid}`},[g("td",null,[g("strong",null,[g("a",{href:"#","data-bs-toggle":"modal","data-bs-target":"#popupModal",onClick:a=>n.activateClosure(e.objectid)},w(e.STREET),9,["onClick"])]),ae,g("small",null,[le,g("strong",null,w(e.FROM_STREET),1),ne,g("strong",null,w(e.TO_STREET),1)])]),g("td",null,w(e.CLOSURE_TYPE.split("_").join(" ")),1),g("td",null,w(n.formatDate(e.DATE_CLOSED)),1),g("td",null,w(n.formatDate(e.DATE_OPENED)),1)],8,["id"])))),128))])])])):(u(),d("div",te,[ie,se]))};const oe={setup:()=>({pagination:U,pages:F})},re={key:0},ce={class:"row align-items-center"},pe={class:"col-sm-9"},ue={"aria-label":"Page navigation"},de={class:"m-0 pagination justify-content-center"},ge=g("span",{"aria-hidden":"true"},"«",-1),me={key:0,class:"page-item disabled"},fe=g("span",{class:"page-link"},"...",-1),ve={key:1,class:"page-item disabled"},be=g("span",{class:"page-link"},"...",-1),ye=g("span",{"aria-hidden":"true"},"»",-1),we={class:"col-sm-3"};oe.render=function(e,a,l,n,t,i){return n.pages>1?(u(),d("div",re,[g("div",ce,[g("div",pe,[g("nav",ue,[g("ul",de,[g("li",{class:["page-item",1==n.pagination.page?"disabled":null]},[g("a",{class:"page-link",href:"#",tabindex:"-1","aria-disabled":1==n.pagination.page,onClick:a[1]||(a[1]=h((e=>n.pagination.page--),["prevent"])),"aria-label":"Previous"},[ge],8,["aria-disabled"])],2),g("li",{class:["page-item",1==n.pagination.page?"active":null],"aria-current":1==n.pagination.page&&"page"},[g("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=h((e=>n.pagination.page=1),["prevent"]))}," 1 ")],10,["aria-current"]),n.pagination.page>3?(u(),d("li",me,[fe])):k("",!0),(u(!0),d(b,null,y(n.pages,(e=>(u(),d(b,{key:e},[1!=e&&e!=n.pages&&Math.abs(n.pagination.page-e)<3?(u(),d("li",{key:0,class:["page-item",n.pagination.page==e?"active":null],"aria-current":n.pagination.page==e&&"page"},[g("a",{class:"page-link",href:"#",onClick:h((a=>n.pagination.page=e),["prevent"])},w(e),9,["onClick"])],10,["aria-current"])):k("",!0)],64)))),128)),n.pagination.page<n.pages-3?(u(),d("li",ve,[be])):k("",!0),g("li",{class:["page-item",n.pagination.page==n.pages?"active":null],"aria-current":n.pagination.page==n.pages&&"page"},[g("a",{class:"page-link",href:"#",onClick:a[3]||(a[3]=h((e=>n.pagination.page=n.pages),["prevent"]))},w(n.pages),1)],10,["aria-current"]),g("li",{class:["page-item",n.pagination.page==n.pages?"disabled":null]},[g("a",{class:"page-link",href:"#","aria-disabled":n.pagination.page==n.pages,onClick:a[4]||(a[4]=h((e=>n.pagination.page++),["prevent"])),"aria-label":"Next"},[ye],8,["aria-disabled"])],2)])])]),g("div",we,[m(g("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>n.pagination.limit=e),class:"form-select form-control","aria-label":"Results per page"},[(u(),d(b,null,y([10,25,50],(e=>g("option",{key:e,value:e},w(`${e} results per page`),9,["value"]))),64))],512),[[T,n.pagination.limit]])])])])):k("",!0)};const Ee=s(null);const he={setup:()=>(C((async()=>{const[e,a,l,n,t]=await o(["esri/views/MapView","esri/widgets/Home","esri/widgets/Legend","esri/Graphic","esri/widgets/Expand"]),i=await S();let s=new e({map:i,container:Ee.value});await s.when(),function(e){e.popup.dockEnabled=!0,e.popup.dockOptions.buttonEnabled=!1,e.popup.collapsed=!1,e.popup.dockOptions.collapseEnabled=!1}(s);const r=i.layers.getItemAt(0);p(P,(e=>{if(!e)return;const a=n.fromJSON(e);s.goTo(a)}));const c=new a({view:s});s.ui.add(c,"top-left");const u=new l({view:s,layerInfos:[{layer:r,title:"Legend"}],container:document.createElement("div")}),d=new t({expandIconClass:"esri-icon-layer-list",expandTooltip:"Expand Legend",view:s,content:u.domNode});s.ui.add(u,"bottom-left"),s.ui.add(d,"top-left")})),{mapRef:Ee})},ke={class:"ratio ratio-16x9"},Te={id:"map",ref:"mapRef",class:"embed-responsive-item"};he.render=function(e,a,l,n,t,i){return u(),d("div",ke,[g("div",Te,null,512)])};let Ce={};const Re=s(null);s(null),p(P,(async function(e){Ce.visible=!1;const[a,l]=await o(["esri/Graphic","esri/widgets/Popup"]),n=a.fromJSON(e);Ce=new l({container:Re.value,features:[n]}),Ce.visible=!0}));const Oe={setup:()=>({popupRef:Re,activeClosure:P})},Me={class:"modal fade",id:"popupModal",tabindex:"-1","aria-labelledby":"popupModalLabel","aria-hidden":"true"},Se={class:"modal-dialog modal-xl"},De={class:"modal-content"},je={class:"modal-header"},xe={class:"modal-title",id:"popupModalLabel"},Le=g("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Pe={ref:"popupRef",class:"modal-body p-1"},_e=g("div",{class:"modal-footer"},[g("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ")],-1);Oe.render=function(e,a,l,n,t,i){var s,o;return u(),d("div",Me,[g("div",Se,[g("div",De,[g("div",je,[g("h5",xe,w(null==(o=null==(s=n.activeClosure)?void 0:s.attributes)?void 0:o.STREET),1),Le]),g("div",Pe,null,512),_e])])])};const Ue={setup:()=>(C((async()=>{await async function(){const e=await S();await e.load(),D.value=e.layers.items[0].toJSON()}(),await V()})),{closures:x}),components:{Filters:J,ClosuresTable:Q,Pagination:oe,ClosuresMap:he,ModalPopup:Oe}},Ne={key:0,class:"py-5"},Ae={class:"alert alert-warning",role:"alert"},Fe={key:1},Ie={key:0,class:"p-5 text-center"},$e=g("div",{class:"spinner-border text-dark",role:"status"},[g("span",{class:"visually-hidden"},"Loading...")],-1);Ue.render=function(e,a,l,n,t,i){const s=R("ClosuresMap"),o=R("Filters"),r=R("ClosuresTable"),c=R("Pagination"),p=R("ModalPopup");return u(),d(b,null,[g(s),n.closures.error?(u(),d("div",Ne,[g("div",Ae,w(n.closures.error),1)])):(u(),d("div",Fe,[g(o,{class:"my-3"}),n.closures.loading?(u(),d("div",Ie,[$e])):(u(),d(r,{key:1})),g(c),g(p)]))],64)},O(Ue).mount("#app");
